(()=>{"use strict";(()=>{const e={ru:[{small:"CapsLock",shift:null,code:"CapsLock"},{small:"ё",shift:"Ё",code:"Backquote"},{small:"1",shift:"!",code:"Digit1"},{small:"2",shift:'"',code:"Digit2"},{small:"3",shift:"№",code:"Digit3"},{small:"4",shift:";",code:"Digit4"},{small:"5",shift:"%",code:"Digit5"},{small:"6",shift:":",code:"Digit6"},{small:"7",shift:"?",code:"Digit7"},{small:"8",shift:"*",code:"Digit8"},{small:"9",shift:"(",code:"Digit9"},{small:"0",shift:")",code:"Digit0"},{small:"-",shift:"_",code:"Minus"},{small:"=",shift:"+",code:"Equal"},{small:"Backspace",shift:null,code:"Backspace"},{small:"Speech",shift:null,code:"Speech"},{small:"Tab",shift:null,code:"Tab"},{small:"й",shift:"Й",code:"KeyQ"},{small:"ц",shift:"Ц",code:"KeyW"},{small:"у",shift:"У",code:"KeyE"},{small:"к",shift:"К",code:"KeyR"},{small:"е",shift:"Е",code:"KeyT"},{small:"н",shift:"Н",code:"KeyY"},{small:"г",shift:"Г",code:"KeyU"},{small:"ш",shift:"Ш",code:"KeyI"},{small:"щ",shift:"Щ",code:"KeyO"},{small:"з",shift:"З",code:"KeyP"},{small:"х",shift:"Х",code:"BracketLeft"},{small:"ъ",shift:"Ъ",code:"BracketRight"},{small:"Enter",shift:null,code:"Enter"},{small:"ф",shift:"Ф",code:"KeyA"},{small:"ы",shift:"Ы",code:"KeyS"},{small:"в",shift:"В",code:"KeyD"},{small:"а",shift:"А",code:"KeyF"},{small:"п",shift:"П",code:"KeyG"},{small:"р",shift:"Р",code:"KeyH"},{small:"о",shift:"О",code:"KeyJ"},{small:"л",shift:"Л",code:"KeyK"},{small:"д",shift:"Д",code:"KeyL"},{small:"ж",shift:"Ж",code:"Semicolon"},{small:"э",shift:"Э",code:"Quote"},{small:"\\",shift:"/",code:"Backslash"},{small:"Shift",shift:null,code:"ShiftLeft"},{small:"/",shift:"|",code:"IntlBackslash"},{small:"я",shift:"Я",code:"KeyZ"},{small:"ч",shift:"Ч",code:"KeyX"},{small:"с",shift:"С",code:"KeyC"},{small:"м",shift:"М",code:"KeyV"},{small:"и",shift:"И",code:"KeyB"},{small:"т",shift:"Т",code:"KeyN"},{small:"ь",shift:"Ь",code:"KeyM"},{small:"б",shift:"Б",code:"Comma"},{small:"ю",shift:"Ю",code:"Period"},{small:".",shift:",",code:"Slash"},{small:"Shift",shift:null,code:"ShiftRight"},{small:"Ctrl",shift:null,code:"ControlLeft"},{small:"Alt",shift:null,code:"AltLeft"},{small:" ",shift:null,code:"Space"},{small:"Alt",shift:null,code:"AltRight"},{small:"Ctrl",shift:null,code:"ControlRight"},{small:"&larr;",shift:null,code:"ArrowLeft"},{small:"&uarr;",shift:null,code:"ArrowUp"},{small:"&darr;",shift:null,code:"ArrowDown"},{small:"&rarr;",shift:null,code:"ArrowRight"},{small:"Win",shift:null,code:"Win"},{small:"RU",shift:null,code:"Lang"},{small:"Close ",shift:null,code:"Done"},{small:"Sound ",shift:null,code:"Sound"}],en:[{small:"`",shift:"~",code:"Backquote"},{small:"1",shift:"!",code:"Digit1"},{small:"2",shift:"@",code:"Digit2"},{small:"3",shift:"#",code:"Digit3"},{small:"4",shift:"$",code:"Digit4"},{small:"5",shift:"%",code:"Digit5"},{small:"6",shift:"^",code:"Digit6"},{small:"7",shift:"&",code:"Digit7"},{small:"8",shift:"*",code:"Digit8"},{small:"9",shift:"(",code:"Digit9"},{small:"0",shift:")",code:"Digit0"},{small:"-",shift:"_",code:"Minus"},{small:"=",shift:"+",code:"Equal"},{small:"Speech",shift:null,code:"Speech"},{small:"Tab",shift:null,code:"Tab"},{small:"q",shift:"Q",code:"KeyQ"},{small:"w",shift:"W",code:"KeyW"},{small:"e",shift:"E",code:"KeyE"},{small:"r",shift:"R",code:"KeyR"},{small:"t",shift:"T",code:"KeyT"},{small:"y",shift:"Y",code:"KeyY"},{small:"u",shift:"U",code:"KeyU"},{small:"i",shift:"I",code:"KeyI"},{small:"o",shift:"O",code:"KeyO"},{small:"p",shift:"P",code:"KeyP"},{small:"[",shift:"{",code:"BracketLeft"},{small:"]",shift:"}",code:"BracketRight"},{small:"Backspace",shift:null,code:"Backspace"},{small:"Close",event:null,code:"Done"},{small:"CapsLock",shift:null,code:"CapsLock"},{small:"a",shift:"A",code:"KeyA"},{small:"s",shift:"S",code:"KeyS"},{small:"d",shift:"D",code:"KeyD"},{small:"f",shift:"F",code:"KeyF"},{small:"g",shift:"G",code:"KeyG"},{small:"h",shift:"H",code:"KeyH"},{small:"j",shift:"J",code:"KeyJ"},{small:"k",shift:"K",code:"KeyK"},{small:"l",shift:"L",code:"KeyL"},{small:";",shift:":",code:"Semicolon"},{small:"'",shift:'"',code:"Quote"},{small:"\\",shift:"|",code:"Backslash"},{small:"Enter",shift:null,code:"Enter"},{small:"Shift",shift:null,code:"ShiftLeft"},{small:"Close ",shift:null,code:"Done"},{small:"z",shift:"Z",code:"KeyZ"},{small:"x",shift:"X",code:"KeyX"},{small:"c",shift:"C",code:"KeyC"},{small:"v",shift:"V",code:"KeyV"},{small:"b",shift:"B",code:"KeyB"},{small:"n",shift:"N",code:"KeyN"},{small:"m",shift:"M",code:"KeyM"},{small:",",shift:"<",code:"Comma"},{small:".",shift:">",code:"Period"},{small:"/",shift:"?",code:"Slash"},{small:"Shift",shift:null,code:"ShiftRight"},{small:"Ctrl",shift:null,code:"ControlLeft"},{small:"Alt",shift:null,code:"AltLeft"},{small:" ",shift:null,code:"Space"},{small:"Alt",shift:null,code:"AltRight"},{small:"Ctrl",shift:null,code:"ControlRight"},{small:"&larr;",shift:null,code:"ArrowLeft"},{small:"&uarr;",shift:null,code:"ArrowUp"},{small:"&darr;",shift:null,code:"ArrowDown"},{small:"&rarr;",shift:null,code:"ArrowRight"},{small:"EN",shift:null,code:"Lang"},{small:"Sound ",shift:null,code:"Sound"}]};function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var s=[],n=!0,i=!1,l=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(s.push(o.value),!t||s.length!==t);n=!0);}catch(e){i=!0,l=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw l}}return s}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function l(e,n,i){var l,o=null;try{o=document.createElement(e)}catch(t){throw new Error("Unable to create HTMLElement with ".concat(e," tag name"))}n&&(l=o.classList).add.apply(l,s(n)),i&&i.appendChild(o);for(var a=arguments.length,r=new Array(a>3?a-3:0),c=3;c<a;c++)r[c-3]=arguments[c];return r.length&&r.forEach((function(e){var s=t(e,2),n=s[0],i=s[1];o.setAttribute(n,i)})),o}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}var a=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Done"],["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backspace"],["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","Enter"],["ShiftLeft","Sound","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ArrowUp","ShiftRight"],["ControlLeft","Lang","AltLeft","Speech","Space","AltRight","ControlRight","ArrowLeft","ArrowDown","ArrowRight"]],r={ru:"ru-RU",en:"en-US"},c=["allBtns.wav","rus.wav","Enter.wav","CapsLock.wav","Backspace.wav","Shift.wav"];({elements:{main:null,keysContainer:null,keys:[],inputField:null,title:null,text:null},eventHandlers:{oninput:null,onclose:null},keyLayout:null,recognition:null,speechIsOn:!1,soundIsOn:!1,properties:{value:"",capsLock:!1,shift:!1,lang:null},init:function(t){var s=this;this.keyLayout=e[t],this.properties.lang=t,this.elements.main=l("div",["keyboard","keyboard--hidden"],document.body),this.elements.keysContainer=l("div",["keyboard__keys"],this.elements.main),this.elements.inputField=document.querySelector(".use-keyboard-input"),this.elements.text=l("span",["text"],document.body);var n=this.createAudio();document.body.appendChild(n),this.elements.keysContainer.appendChild(this._createKeys()),this.elements.keys=this.elements.keysContainer.querySelectorAll(".keyboard__key"),this.elements.keys.forEach((function(e){var t=e.getAttribute("data-code");!s.keyLayout.find((function(e){return e.code===t})).shift||e.classList.add("fs20")}));var i=new(window.speechRecognition||window.webkitSpeechRecognition);i.continuous=!0,i.lang=r[this.lang],i.onstart=function(){},i.onerror=function(e){},i.addEventListener("end",(function(e){s.elements.keysContainer.querySelector('[data-code*="Speech"]').classList.remove("keyboard__key--dark")})),i.addEventListener("result",(function(e){if(e.results.length>0){var t=e.results[e.results.length-1][0].transcript;s.characterInput(t,t.length),s._triggerEvent("oninput")}})),this.recognition=i,document.addEventListener("keydown",(function(e){20!=e.which&&20!=e.keyCode||s._toggleCapsLock()})),document.addEventListener("keydown",(function(e){e.shiftKey&&s._toggleShift()})),document.addEventListener("keydown",(function(e){e.altKey&&e.preventDefault()})),window.addEventListener("keydown",(function(e){var t=document.querySelector("[data-code= ".concat(e.code,"]"));if(t&&(t.classList.add("pressed-button"),s.keyLayout.find((function(t){return t.code===e.code})).shift)){var n=t.textContent;e.preventDefault(),s.characterInput(n)}})),window.addEventListener("keyup",(function(e){var t=document.querySelector("[data-code= ".concat(e.code,"]"));t&&t.classList.remove("pressed-button"),s.properties.value=document.querySelector(".use-keyboard-input").value})),document.querySelectorAll(".input__keyboard").forEach((function(e){e.addEventListener("click",(function(){s.toggleClose()}))})),this.properties.value=this.elements.inputField.value||"",this.eventHandlers.oninput=function(e){!function(e,t){var s=(Object.getOwnPropertyDescriptor(e,"value")||{}).set,n=Object.getPrototypeOf(e),i=(Object.getOwnPropertyDescriptor(n,"value")||{}).set;if(i&&s!==i)i.call(e,t);else{if(!s)throw new Error("The given element does not have a value setter");s.call(e,t)}}(s.elements.inputField,e);var t=new Event("input",{bubbles:!0,cancelable:!0});s.elements.inputField.dispatchEvent(t)}},createAudio:function(){var e=document.createDocumentFragment();return c.forEach((function(t){var s=document.createElement("audio");s.setAttribute("src","./virtual-keyboard/assets/sounds/".concat(t)),e.appendChild(s)})),e},playSound:function(e){if(this.soundIsOn){var t=document.querySelector("audio[src*=".concat(e,"]"));e.includes("Shift")&&(t=document.querySelector('audio[src*="Shift"]')),t||(t="en"===this.properties.lang?document.querySelector('audio[src*="allBtns"]'):document.querySelector('audio[src*="rus"]')),t.currentTime=0,t.play()}},addAnimation:function(e,t){this.elements.text.classList.contains("zoom")&&this.elements.text.classList.remove("zoom"),this.elements.text.offsetWidth,e?(this.elements.text.textContent="".concat(t," is on"),this.elements.text.classList.add("zoom")):(this.elements.text.textContent="".concat(t," is off"),this.elements.text.classList.add("zoom"))},_createKeys:function(){var e=this,t=document.createDocumentFragment(),s=function(e){return'<i class="material-icons">'.concat(e,"</i>")};return a.forEach((function(n,i){var l=document.createElement("div");n.forEach((function(t){var n=document.createElement("button");n.addEventListener("click",(function(s){e.playSound(t)})),n.setAttribute("type","button"),n.classList.add("keyboard__key");var i=e.keyLayout.find((function(e){return e.code===t}));if(i){switch(n.setAttribute("data-code",i.code),n=e.changeInnerHTML(n,i),i.code){case"Backspace":n.classList.add("keyboard__key--wide"),n.addEventListener("click",(function(){var t=e.elements.inputField.selectionStart,s=e.properties.value;if(document.getSelection().toString()){var n=e.elements.inputField.selectionStart,i=e.elements.inputField.selectionEnd;e.properties.value=s.substring(0,n)+s.substring(i),e._triggerEvent("oninput"),e.elements.inputField.focus(),e.elements.inputField.setSelectionRange(t,t)}else e.elements.inputField.focus(),e.properties.value=s.substring(0,t-1)+s.substring(t),e._triggerEvent("oninput"),e.elements.inputField.setSelectionRange(t-1,t-1)}));break;case"ArrowLeft":n.addEventListener("click",(function(){var t=e.elements.inputField.selectionStart;t=t-1>=0?t-1:0,e.elements.inputField.focus(),e.elements.inputField.setSelectionRange(t,t)}));break;case"Sound":n.innerHTML=s("campaign"),n.addEventListener("click",(function(){e.soundIsOn=!e.soundIsOn,e.addAnimation(e.soundIsOn,"Key sound"),n.classList.toggle("keyboard__key--dark")}));break;case"ArrowRight":n.addEventListener("click",(function(){var t=e.elements.inputField.selectionStart;e.elements.inputField.focus(),e.elements.inputField.setSelectionRange(t+1,t+1)}));break;case"ArrowUp":case"ArrowDown":case"AltLeft":case"AltRight":n.addEventListener("click",(function(){e.setFocus()}));break;case"ControlRight":case"ControlLeft":n.addEventListener("click",(function(){e.setFocus()}));break;case"CapsLock":n.classList.add("keyboard__key--wide","keyboard__key--activatable"),n.addEventListener("click",(function(){e._toggleCapsLock()}));break;case"Enter":n.classList.add("keyboard__key--middle"),n.addEventListener("click",(function(t){e.characterInput("\n")}));break;case"Tab":n.classList.add("keyboard__key--middle"),n.addEventListener("click",(function(t){e.characterInput("\t")}));break;case"Space":n.classList.add("keyboard__key--extra-wide"),n.addEventListener("click",(function(){e.characterInput(" ")}));break;case"Done":n.classList.add("keyboard__key--wide"),n.addEventListener("click",(function(){e.close(),e._triggerEvent("onclose")}));break;case"Speech":n.innerHTML=s("mic"),n.addEventListener("click",(function(t){e._speechInput(t)}));break;case"ShiftLeft":case"ShiftRight":n.classList.add("keyboard__key--middle","keyboard__key--activatable"),n.addEventListener("click",(function(t){e._toggleShift(t)}));break;case"Lang":n.addEventListener("click",(function(t){e._toggleLang(t)}));break;default:n.addEventListener("click",(function(t){var s=n.textContent;e.characterInput(s)}))}l.appendChild(n)}})),t.appendChild(l)})),t},changeInnerHTML:function(e,t){return 0!==e.childElementCount||(this.properties.shift&&!this.properties.capsLock?e.innerHTML=t.shift?t.shift:t.small:!this.properties.shift&&this.properties.capsLock?t.small.match(/^[a-zа-яё]{1}$/i)?e.innerHTML=t.small.toUpperCase():e.innerHTML=t.small:this.properties.shift&&this.properties.capsLock?t.small.match(/^[a-zа-яё]{1}$/i)?e.innerHTML=t.small.toLowerCase():e.innerHTML=t.shift?t.shift:t.small:e.innerHTML=t.small),e},characterInput:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=document.getSelection().toString(),n=this.elements.inputField.selectionStart,i=this.properties.value;if(s){var l=n,o=this.elements.inputField.selectionEnd;this.properties.value=i.substring(0,l)+e+i.substring(o)}else this.properties.value=i.substring(0,n)+e+i.substring(n);this._triggerEvent("oninput"),this.elements.inputField.focus(),this.elements.inputField.setSelectionRange(n+t,n+t)},_triggerEvent:function(e){"function"==typeof this.eventHandlers[e]&&this.eventHandlers[e](this.properties.value)},isUpper:function(){return this.properties.capsLock^this.properties.shift},_toggleCapsLock:function(e){this.properties.capsLock=!this.properties.capsLock,document.querySelector("[data-code= CapsLock]").classList.toggle("keyboard__key--active",this.properties.capsLock);var t,s=function(e,t){var s;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return o(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,r=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return a=e.done,e},e:function(e){r=!0,l=e},f:function(){try{a||null==s.return||s.return()}finally{if(r)throw l}}}}(this.elements.keys);try{for(s.s();!(t=s.n()).done;){var n=t.value;n.textContent.match(/^[a-zа-яё]{1}$/i)&&0===n.childElementCount&&(n.textContent=this.isUpper()?n.textContent.toUpperCase():n.textContent.toLowerCase())}}catch(e){s.e(e)}finally{s.f()}},_toggleLang:function(t){var s=this;this.properties.lang="en"===this.properties.lang?"ru":"en",this.keyLayout=e[this.properties.lang],this.recognition.lang=r[this.properties.lang],this.speechIsOn&&this._speechInput(t),this.elements.keys.forEach((function(e){var t=e.getAttribute("data-code"),n=s.keyLayout.find((function(e){return e.code===t}));n&&s.changeInnerHTML(e,n)}))},_speechInput:function(e){this.setFocus(),this.speechIsOn=!this.speechIsOn,this.addAnimation(this.speechIsOn,"Voice input"),this.elements.keysContainer.querySelector('[data-code*="Speech"]').classList.toggle("keyboard__key--dark"),this.speechIsOn?this.recognition.start():this.recognition.stop()},_toggleShift:function(e){var t=this;this.properties.shift=!this.properties.shift,this.elements.keys.forEach((function(e){var s=e.getAttribute("data-code"),n=t.keyLayout.find((function(e){return e.code===s}));n&&t.changeInnerHTML(e,n)})),this.elements.keysContainer.querySelectorAll('[data-code*="Shift"]').forEach((function(e){e.classList.toggle("keyboard__key--active",t.properties.shift)})),this.elements.keysContainer.querySelector('[data-code*="CapsLock"]').classList.toggle("keyboard__key--active",this.properties.capsLock)},setFocus:function(){var e=this.elements.inputField.selectionStart;this.elements.inputField.focus(),this.elements.inputField.setSelectionRange(e,e)},open:function(){this.elements.main.classList.remove("keyboard--hidden")},close:function(){this.elements.main.classList.add("keyboard--hidden")},toggleClose:function(){this.elements.main.classList.toggle("keyboard--hidden")}}).init("en")})()})();